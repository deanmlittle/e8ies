/**
 * e8ies.js - v1.0.1
 * A 21e8 ECIES library
 * https://github.com/deanmlittle/e8ies
 * Copyright Â© 2021 Dean Little.
 */

var e8ies=function(e,r){"use strict";class f{}return f.encrypt=(e,f=218,s=null)=>{if(!Buffer.isBuffer(e))throw new Error("messageBuf must be a buffer");let t;t=s?r.KeyPair.fromPrivKey(r.PrivKey.fromString(s)):r.KeyPair.fromRandom();const c=t.pubKey.toDer(!0);let i=Buffer.from(c,"hex");console.log(i);for(let e=0;e<f;e++)i=r.Hash.sha256(i);const n=r.KeyPair.fromPrivKey(new r.PrivKey(r.Bn.fromBuffer(i))),{iv:u,kE:o,kM:a}=r.Ecies.ivkEkM(t.privKey,n.pubKey),l=r.Aescbc.encrypt(e,o,u,!1),y=i.slice(0,4),h=Buffer.concat([y,c,l]),m=r.Hash.sha256Hmac(h,a);return Buffer.concat([h,m])},f.mine=e=>{if(!Buffer.isBuffer(e))throw new Error("encBuf must be a buffer");const s=e.slice(0,4);let t=!1,c=e.slice(4,37);const i=r.PubKey.fromDer(c);for(;!t;)if(c=r.Hash.sha256(c),s.equals(c.slice(0,4))){const s=new r.PrivKey(r.Bn.fromBuffer(c));t=f.decrypt(e,s,i)}return t},f.decrypt=(e,f,s)=>{if(!Buffer.isBuffer(e))throw new Error("encBuf must be a buffer");const{iv:t,kE:c,kM:i}=r.Ecies.ivkEkM(f,s),n=e.slice(37,e.length-32),u=e.slice(e.length-32,e.length),o=r.Hash.sha256Hmac(e.slice(0,e.length-32),i);return!!u.equals(o)&&r.Aescbc.decrypt(n,c,t)},e.e8ies=f,Object.defineProperty(e,"__esModule",{value:!0}),e}({},bsvjs);
